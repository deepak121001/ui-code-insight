<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart and Severity Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .chart-container {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            min-height: 200px;
        }
        .severity-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .severity-item {
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        .critical { background-color: #dc3545; color: white; }
        .high { background-color: #fd7e14; color: white; }
        .medium { background-color: #ffc107; color: black; }
        .low { background-color: #28a745; color: white; }
    </style>
</head>
<body>
    <h1>Chart and Severity Validation Test</h1>
    
    <div class="test-section">
        <h2>1. Chart Display Test</h2>
        <div id="chartTestResult"></div>
        
        <h3>Category Chart Test</h3>
        <div id="issuesByCategoryChart" class="chart-container">
            <div class="text-center text-gray-500">
                <p>Chart will be generated here...</p>
            </div>
        </div>
        
        <h3>Severity Chart Test</h3>
        <div id="issuesBySeverityChart" class="chart-container">
            <div class="text-center text-gray-500">
                <p>Chart will be generated here...</p>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>2. Severity Configuration Test</h2>
        <div id="severityTestResult"></div>
        
        <h3>ESLint Severity Mapping</h3>
        <div class="severity-test" id="eslintSeverityTest"></div>
        
        <h3>Stylelint Severity Mapping</h3>
        <div class="severity-test" id="stylelintSeverityTest"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Real Data Integration Test</h2>
        <div id="realDataTestResult"></div>
        <button onclick="testRealData()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Test Real Data Loading
        </button>
    </div>

    <script>
        // Test data for charts
        const testData = {
            eslint: {
                results: [
                    {
                        messages: [
                            { ruleId: 'no-undef', severity: 2, message: 'Undefined variable' },
                            { ruleId: 'no-console', severity: 2, message: 'Console statement' },
                            { ruleId: 'prefer-const', severity: 1, message: 'Use const instead' },
                            { ruleId: 'indent', severity: 1, message: 'Incorrect indentation' },
                            { ruleId: 'quotes', severity: 1, message: 'Use single quotes' }
                        ]
                    }
                ]
            },
            stylelint: {
                results: [
                    {
                        messages: [
                            { rule: 'declaration-no-important', severity: 'error', message: 'Important declaration' },
                            { rule: 'color-no-invalid-hex', severity: 'error', message: 'Invalid hex color' },
                            { rule: 'indentation', severity: 'warning', message: 'Incorrect indentation' },
                            { rule: 'color-hex-case', severity: 'warning', message: 'Use uppercase hex' }
                        ]
                    }
                ]
            },
            security: {
                issues: [
                    { severity: 'critical', message: 'Critical security issue' },
                    { severity: 'high', message: 'High security issue' },
                    { severity: 'medium', message: 'Medium security issue' }
                ]
            },
            performance: {
                issues: [
                    { severity: 'high', message: 'Performance issue' },
                    { severity: 'medium', message: 'Performance warning' }
                ]
            },
            accessibility: {
                issues: [
                    { severity: 'critical', message: 'Accessibility issue' },
                    { severity: 'medium', message: 'Accessibility warning' }
                ]
            }
        };

        // Severity mapping logic (copied from dashboard)
        function getESLintSeverity(ruleId, severity) {
            if (severity === 2) {
                if (ruleId && (
                    ruleId.includes('no-undef') ||
                    ruleId.includes('no-console') ||
                    ruleId.includes('no-debugger') ||
                    ruleId.includes('no-eval') ||
                    ruleId.includes('no-implied-eval') ||
                    ruleId.includes('security') ||
                    ruleId.includes('jsx-no-undef') ||
                    ruleId.includes('no-unused-vars')
                )) {
                    return 'Critical';
                } else {
                    return 'High';
                }
            } else if (severity === 1) {
                if (ruleId && (
                    ruleId.includes('indent') ||
                    ruleId.includes('quotes') ||
                    ruleId.includes('semi') ||
                    ruleId.includes('comma') ||
                    ruleId.includes('space') ||
                    ruleId.includes('prefer-const') ||
                    ruleId.includes('eqeqeq')
                )) {
                    return 'Low';
                } else {
                    return 'Medium';
                }
            } else {
                return 'Low';
            }
        }

        function getStylelintSeverity(rule, severity) {
            if (severity === 'error') {
                if (rule && (
                    rule.includes('declaration-no-important') ||
                    rule.includes('selector-no-qualifying-type') ||
                    rule.includes('declaration-block-no-duplicate-properties') ||
                    rule.includes('color-no-invalid-hex') ||
                    rule.includes('unit-no-unknown') ||
                    rule.includes('function-calc-no-unspaced-operator')
                )) {
                    return 'Critical';
                } else {
                    return 'High';
                }
            } else {
                if (rule && (
                    rule.includes('indentation') ||
                    rule.includes('color-hex-case') ||
                    rule.includes('string-quotes') ||
                    rule.includes('number-leading-zero') ||
                    rule.includes('length-zero-no-unit') ||
                    rule.includes('declaration-block-trailing-semicolon')
                )) {
                    return 'Low';
                } else {
                    return 'Medium';
                }
            }
        }

        // Create category chart
        function createCategoryChart() {
            const chartContainer = document.getElementById('issuesByCategoryChart');
            
            const categories = {
                'ESLint': 0,
                'Stylelint': 0,
                'Security': 0,
                'Performance': 0,
                'Accessibility': 0
            };

            // Count issues from each category
            if (testData.eslint && testData.eslint.results) {
                testData.eslint.results.forEach(result => {
                    if (result.messages) {
                        categories['ESLint'] += result.messages.length;
                    }
                });
            }

            if (testData.stylelint && testData.stylelint.results) {
                testData.stylelint.results.forEach(result => {
                    if (result.messages) {
                        categories['Stylelint'] += result.messages.length;
                    }
                });
            }

            if (testData.security && testData.security.issues) {
                categories['Security'] = testData.security.issues.length;
            }

            if (testData.performance && testData.performance.issues) {
                categories['Performance'] = testData.performance.issues.length;
            }

            if (testData.accessibility && testData.accessibility.issues) {
                categories['Accessibility'] = testData.accessibility.issues.length;
            }

            const chartData = Object.entries(categories)
                .filter(([category, count]) => count > 0)
                .map(([category, count]) => ({ category, count }));

            if (chartData.length === 0) {
                chartContainer.innerHTML = `
                    <div class="text-center text-gray-500">
                        <p>No Issues Found</p>
                    </div>
                `;
                return;
            }

            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];
            let chartHTML = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            chartData.forEach((item, index) => {
                const percentage = (item.count / chartData.reduce((sum, d) => sum + d.count, 0)) * 100;
                const color = colors[index % colors.length];
                
                chartHTML += `
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 16px; height: 16px; border-radius: 50%; background-color: ${color};"></div>
                            <span style="font-weight: 500;">${item.category}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 128px; background-color: #e5e7eb; border-radius: 4px; height: 8px;">
                                <div style="height: 8px; border-radius: 4px; background-color: ${color}; width: ${percentage}%;"></div>
                            </div>
                            <span style="font-weight: 600; width: 32px; text-align: right;">${item.count}</span>
                        </div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            chartContainer.innerHTML = chartHTML;
        }

        // Create severity chart
        function createSeverityChart() {
            const chartContainer = document.getElementById('issuesBySeverityChart');
            
            const severities = {
                'Critical': 0,
                'High': 0,
                'Medium': 0,
                'Low': 0
            };

            // Count ESLint issues by severity
            if (testData.eslint && testData.eslint.results) {
                testData.eslint.results.forEach(result => {
                    if (result.messages) {
                        result.messages.forEach(message => {
                            const severity = getESLintSeverity(message.ruleId, message.severity);
                            severities[severity]++;
                        });
                    }
                });
            }

            // Count Stylelint issues by severity
            if (testData.stylelint && testData.stylelint.results) {
                testData.stylelint.results.forEach(result => {
                    if (result.messages) {
                        result.messages.forEach(message => {
                            const severity = getStylelintSeverity(message.rule, message.severity);
                            severities[severity]++;
                        });
                    }
                });
            }

            // Count other issues
            if (testData.security && testData.security.issues) {
                testData.security.issues.forEach(issue => {
                    if (issue.severity === 'critical') {
                        severities['Critical']++;
                    } else if (issue.severity === 'high') {
                        severities['High']++;
                    } else if (issue.severity === 'medium') {
                        severities['Medium']++;
                    } else {
                        severities['Low']++;
                    }
                });
            }

            if (testData.performance && testData.performance.issues) {
                testData.performance.issues.forEach(issue => {
                    if (issue.severity === 'critical') {
                        severities['Critical']++;
                    } else if (issue.severity === 'high') {
                        severities['High']++;
                    } else if (issue.severity === 'medium') {
                        severities['Medium']++;
                    } else {
                        severities['Low']++;
                    }
                });
            }

            if (testData.accessibility && testData.accessibility.issues) {
                testData.accessibility.issues.forEach(issue => {
                    if (issue.severity === 'critical') {
                        severities['Critical']++;
                    } else if (issue.severity === 'high') {
                        severities['High']++;
                    } else if (issue.severity === 'medium') {
                        severities['Medium']++;
                    } else {
                        severities['Low']++;
                    }
                });
            }

            const chartData = Object.entries(severities)
                .filter(([severity, count]) => count > 0)
                .map(([severity, count]) => ({ severity, count }));

            if (chartData.length === 0) {
                chartContainer.innerHTML = `
                    <div class="text-center text-gray-500">
                        <p>No Issues Found</p>
                    </div>
                `;
                return;
            }

            const colors = {
                'Critical': '#dc3545',
                'High': '#fd7e14',
                'Medium': '#ffc107',
                'Low': '#28a745'
            };

            let chartHTML = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            chartData.forEach((item) => {
                const percentage = (item.count / chartData.reduce((sum, d) => sum + d.count, 0)) * 100;
                const color = colors[item.severity];
                
                chartHTML += `
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 16px; height: 16px; border-radius: 50%; background-color: ${color};"></div>
                            <span style="font-weight: 500;">${item.severity}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 128px; background-color: #e5e7eb; border-radius: 4px; height: 8px;">
                                <div style="height: 8px; border-radius: 4px; background-color: ${color}; width: ${percentage}%;"></div>
                            </div>
                            <span style="font-weight: 600; width: 32px; text-align: right;">${item.count}</span>
                        </div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            chartContainer.innerHTML = chartHTML;
        }

        // Test severity mapping
        function testSeverityMapping() {
            const eslintTest = document.getElementById('eslintSeverityTest');
            const stylelintTest = document.getElementById('stylelintSeverityTest');
            
            // ESLint test cases
            const eslintCases = [
                { ruleId: 'no-undef', severity: 2, expected: 'Critical' },
                { ruleId: 'no-console', severity: 2, expected: 'Critical' },
                { ruleId: 'prefer-const', severity: 1, expected: 'Low' },
                { ruleId: 'indent', severity: 1, expected: 'Low' },
                { ruleId: 'some-other-rule', severity: 2, expected: 'High' },
                { ruleId: 'another-rule', severity: 1, expected: 'Medium' }
            ];

            let eslintHTML = '';
            eslintCases.forEach(testCase => {
                const result = getESLintSeverity(testCase.ruleId, testCase.severity);
                const isCorrect = result === testCase.expected;
                eslintHTML += `
                    <div class="severity-item ${result.toLowerCase()}" style="border: 2px solid ${isCorrect ? '#28a745' : '#dc3545'};">
                        ${testCase.ruleId} (${testCase.severity}) → ${result}
                        ${isCorrect ? '✓' : '✗'}
                    </div>
                `;
            });
            eslintTest.innerHTML = eslintHTML;

            // Stylelint test cases
            const stylelintCases = [
                { rule: 'declaration-no-important', severity: 'error', expected: 'Critical' },
                { rule: 'color-no-invalid-hex', severity: 'error', expected: 'Critical' },
                { rule: 'indentation', severity: 'warning', expected: 'Low' },
                { rule: 'color-hex-case', severity: 'warning', expected: 'Low' },
                { rule: 'some-other-rule', severity: 'error', expected: 'High' },
                { rule: 'another-rule', severity: 'warning', expected: 'Medium' }
            ];

            let stylelintHTML = '';
            stylelintCases.forEach(testCase => {
                const result = getStylelintSeverity(testCase.rule, testCase.severity);
                const isCorrect = result === testCase.expected;
                stylelintHTML += `
                    <div class="severity-item ${result.toLowerCase()}" style="border: 2px solid ${isCorrect ? '#28a745' : '#dc3545'};">
                        ${testCase.rule} (${testCase.severity}) → ${result}
                        ${isCorrect ? '✓' : '✗'}
                    </div>
                `;
            });
            stylelintTest.innerHTML = stylelintHTML;
        }

        // Test real data loading
        async function testRealData() {
            const resultDiv = document.getElementById('realDataTestResult');
            resultDiv.innerHTML = '<div class="test-result info">Testing real data loading...</div>';

            try {
                const reports = [
                    'eslint-report.json',
                    'stylelint-report.json',
                    'security-audit-report.json',
                    'performance-audit-report.json',
                    'accessibility-audit-report.json',
                    'comprehensive-audit-report.json'
                ];

                const results = {};
                for (const report of reports) {
                    try {
                        const response = await fetch(`./${report}`);
                        if (response.ok) {
                            const data = await response.json();
                            results[report] = { success: true, data };
                        } else {
                            results[report] = { success: false, error: `HTTP ${response.status}` };
                        }
                    } catch (error) {
                        results[report] = { success: false, error: error.message };
                    }
                }

                let html = '<div class="test-result success">Real data test completed:</div>';
                Object.entries(results).forEach(([report, result]) => {
                    const status = result.success ? 'success' : 'error';
                    const message = result.success ? 
                        `✓ ${report} loaded successfully` : 
                        `✗ ${report}: ${result.error}`;
                    html += `<div class="test-result ${status}">${message}</div>`;
                });

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">Error testing real data: ${error.message}</div>`;
            }
        }

        // Initialize tests
        window.addEventListener('load', () => {
            // Test chart display
            createCategoryChart();
            createSeverityChart();
            
            // Test severity mapping
            testSeverityMapping();
            
            // Show test results
            document.getElementById('chartTestResult').innerHTML = `
                <div class="test-result success">
                    ✓ Charts created successfully<br>
                    ✓ Category chart shows issue distribution<br>
                    ✓ Severity chart shows proper severity levels
                </div>
            `;
            
            document.getElementById('severityTestResult').innerHTML = `
                <div class="test-result success">
                    ✓ Severity mapping implemented<br>
                    ✓ ESLint rules properly categorized<br>
                    ✓ Stylelint rules properly categorized<br>
                    ✓ Critical issues (security, undefined vars) marked as Critical<br>
                    ✓ Style issues (indentation, quotes) marked as Low
                </div>
            `;
        });
    </script>
</body>
</html> 