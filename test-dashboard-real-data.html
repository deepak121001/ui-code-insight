<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Real Data Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            min-width: 120px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>Dashboard Real Data Test</h1>
    
    <div class="test-section">
        <h2>üìä Main Dashboard Metrics</h2>
        <p>Testing if the main dashboard tab shows real data for:</p>
        <ul>
            <li>Security Score</li>
            <li>Performance Score</li>
            <li>Accessibility Score</li>
            <li>Issues by Category chart</li>
            <li>Issues by Severity chart</li>
        </ul>
        
        <div id="metrics-test">
            <div class="metric">
                <div class="metric-value" id="security-score">-</div>
                <div class="metric-label">Security Score</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="performance-score">-</div>
                <div class="metric-label">Performance Score</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="accessibility-score">-</div>
                <div class="metric-label">Accessibility Score</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìà Charts Test</h2>
        <div id="charts-test">
            <div style="margin-bottom: 20px;">
                <h3>Issues by Category</h3>
                <div id="category-chart-test">Loading...</div>
            </div>
            <div>
                <h3>Issues by Severity</h3>
                <div id="severity-chart-test">Loading...</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîç Data Source Verification</h2>
        <div id="data-sources">
            <p>Checking data sources:</p>
            <ul id="sources-list"></ul>
        </div>
    </div>

    <script>
        async function testDashboardData() {
            console.log('üß™ Starting dashboard real data test...');
            
            // Test loading real data
            try {
                // Load all report files
                const reports = [
                    'comprehensive-audit-report.json',
                    'eslint-report.json',
                    'stylelint-report.json',
                    'security-audit-report.json',
                    'performance-audit-report.json',
                    'accessibility-audit-report.json',
                    'lightHouseCombine-report.json'
                ];

                const sourcesList = document.getElementById('sources-list');
                const results = {};

                for (const report of reports) {
                    try {
                        const response = await fetch(`./${report}`);
                        if (response.ok) {
                            const data = await response.json();
                            results[report] = data;
                            
                            const li = document.createElement('li');
                            li.className = 'success';
                            li.textContent = `‚úÖ ${report} - Loaded successfully`;
                            sourcesList.appendChild(li);
                        } else {
                            const li = document.createElement('li');
                            li.className = 'error';
                            li.textContent = `‚ùå ${report} - Failed to load (${response.status})`;
                            sourcesList.appendChild(li);
                        }
                    } catch (error) {
                        const li = document.createElement('li');
                        li.className = 'error';
                        li.textContent = `‚ùå ${report} - Error: ${error.message}`;
                        sourcesList.appendChild(li);
                    }
                }

                // Calculate metrics manually to verify
                if (results['eslint-report.json'] || results['stylelint-report.json'] || 
                    results['security-audit-report.json'] || results['performance-audit-report.json'] || 
                    results['accessibility-audit-report.json'] || results['lightHouseCombine-report.json']) {
                    
                    // Calculate metrics similar to dashboard
                    let securityScore = 100;
                    let performanceScore = 100;
                    let accessibilityScore = 100;

                    // Security score calculation
                    if (results['security-audit-report.json']) {
                        const securityData = results['security-audit-report.json'];
                        if (securityData.issues) {
                            const highVulns = securityData.issues.filter(issue => 
                                issue.severity === 'high' || issue.severity === 'critical'
                            ).length;
                            const totalVulns = securityData.issues.length;
                            securityScore = Math.max(0, 100 - (highVulns * 10) - (totalVulns * 2));
                        }
                    }

                    // Performance score from Lighthouse
                    if (results['lightHouseCombine-report.json']) {
                        const lighthouseData = results['lightHouseCombine-report.json'];
                        if (lighthouseData.length > 0) {
                            const firstReport = lighthouseData[0];
                            if (firstReport.desktop && firstReport.desktop.performance) {
                                performanceScore = firstReport.desktop.performance;
                            } else if (firstReport.mobile && firstReport.mobile.performance) {
                                performanceScore = firstReport.mobile.performance;
                            }
                        }
                    }

                    // Accessibility score from Lighthouse
                    if (results['lightHouseCombine-report.json']) {
                        const lighthouseData = results['lightHouseCombine-report.json'];
                        if (lighthouseData.length > 0) {
                            const firstReport = lighthouseData[0];
                            if (firstReport.desktop && firstReport.desktop.accessibility) {
                                accessibilityScore = firstReport.desktop.accessibility;
                            } else if (firstReport.mobile && firstReport.mobile.accessibility) {
                                accessibilityScore = firstReport.mobile.accessibility;
                            }
                        }
                    }

                    // Accessibility score from accessibility audit
                    if (results['accessibility-audit-report.json']) {
                        const accessibilityData = results['accessibility-audit-report.json'];
                        if (accessibilityData.issues) {
                            const accessibilityIssues = accessibilityData.issues.length;
                            accessibilityScore = Math.max(0, 100 - (accessibilityIssues * 5));
                        }
                    }

                    // Update metrics display
                    document.getElementById('security-score').textContent = Math.round(securityScore);
                    document.getElementById('performance-score').textContent = Math.round(performanceScore);
                    document.getElementById('accessibility-score').textContent = Math.round(accessibilityScore);

                    // Test charts
                    testCharts(results);
                }

            } catch (error) {
                console.error('‚ùå Error testing dashboard data:', error);
                document.getElementById('metrics-test').innerHTML = '<p class="error">Error loading test data</p>';
            }
        }

        function testCharts(results) {
            const categoryChart = document.getElementById('category-chart-test');
            const severityChart = document.getElementById('severity-chart-test');

            // Test Issues by Category chart
            const categories = {
                'ESLint': 0,
                'Stylelint': 0,
                'Security': 0,
                'Performance': 0,
                'Accessibility': 0
            };

            // Count issues from each category
            if (results['eslint-report.json'] && results['eslint-report.json'].results) {
                results['eslint-report.json'].results.forEach(result => {
                    if (result.messages) {
                        categories['ESLint'] += result.messages.length;
                    }
                });
            }

            if (results['stylelint-report.json'] && results['stylelint-report.json'].results) {
                results['stylelint-report.json'].results.forEach(result => {
                    if (result.messages) {
                        categories['Stylelint'] += result.messages.length;
                    }
                });
            }

            if (results['security-audit-report.json'] && results['security-audit-report.json'].issues) {
                categories['Security'] = results['security-audit-report.json'].issues.length;
            }

            if (results['performance-audit-report.json'] && results['performance-audit-report.json'].issues) {
                categories['Performance'] = results['performance-audit-report.json'].issues.length;
            }

            if (results['accessibility-audit-report.json'] && results['accessibility-audit-report.json'].issues) {
                categories['Accessibility'] = results['accessibility-audit-report.json'].issues.length;
            }

            // Display category chart
            const chartData = Object.entries(categories)
                .filter(([category, count]) => count > 0)
                .map(([category, count]) => ({ category, count }));

            if (chartData.length > 0) {
                let chartHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">';
                chartData.forEach(item => {
                    chartHTML += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: #333;">${item.count}</div>
                            <div style="font-size: 12px; color: #666;">${item.category}</div>
                        </div>
                    `;
                });
                chartHTML += '</div>';
                categoryChart.innerHTML = chartHTML;
            } else {
                categoryChart.innerHTML = '<p class="info">No issues found in any category</p>';
            }

            // Test Issues by Severity chart
            const severities = {
                'Critical': 0,
                'High': 0,
                'Medium': 0,
                'Low': 0
            };

            // Count by severity (simplified)
            if (results['security-audit-report.json'] && results['security-audit-report.json'].issues) {
                results['security-audit-report.json'].issues.forEach(issue => {
                    if (issue.severity === 'critical') {
                        severities['Critical']++;
                    } else if (issue.severity === 'high') {
                        severities['High']++;
                    } else if (issue.severity === 'medium') {
                        severities['Medium']++;
                    } else {
                        severities['Low']++;
                    }
                });
            }

            const severityData = Object.entries(severities)
                .filter(([severity, count]) => count > 0)
                .map(([severity, count]) => ({ severity, count }));

            if (severityData.length > 0) {
                let chartHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">';
                severityData.forEach(item => {
                    chartHTML += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: #333;">${item.count}</div>
                            <div style="font-size: 12px; color: #666;">${item.severity}</div>
                        </div>
                    `;
                });
                chartHTML += '</div>';
                severityChart.innerHTML = chartHTML;
            } else {
                severityChart.innerHTML = '<p class="info">No issues found by severity</p>';
            }
        }

        // Run test when page loads
        document.addEventListener('DOMContentLoaded', testDashboardData);
    </script>
</body>
</html> 